EBG=EBG||{};EBG.Adaptors=EBG.Adaptors||{};EBG.Adaptors.CMPDetector=function (options){var $this=this;options=options||{timeout:300,accurateTimeout:0};if(window.__cmp&&typeof __cmp=="function"){this.exists=true;}else{this._detectCMPLocator();}if(!this.exists){this._setReason(0);this._setDefaultValue();return;}setTimeout(function (){var callee=arguments.callee;$this.cmpCheckTimedout=true;$this._timeoutActualTime=new Date().getTime()-$this._startTime;if(options.accurateTimeout){options.accurateTimeout--;if($this._timeoutActualTime<options.timeout){if(!$this._timeoutTimeGap){$this._timeoutTimeGap=options.timeout-$this._timeoutActualTime;}setTimeout(function (){callee.apply($this,[]);},Math.max(options.timeout-$this._timeoutActualTime,1));return;}}if(typeof $this.consentData=="undefined"){$this._setReason(-1);$this._setDefaultValue();$this._publishConsentData();}},options.timeout);this._startTime=new Date().getTime();try{(function (){var callee=arguments.callee;__cmp("ping",null,function (res,success){if(success&&res.cmpLoaded){$this.initialized=true;$this._getConsentData(function (consent){$this._time=new Date().getTime()-$this._startTime;if(typeof this.consentData=="undefined"){if(consent&&typeof consent.gdprApplies=="number"){consent.gdprApplies=consent.gdprApplies+"";}$this.consentData=consent;$this._publishConsentData();}});}else{if(!$this.cmpCheckTimedout){setTimeout(function (){callee.apply($this,[]);},5);}}});})();}catch(e){$this._setDefaultValue();$this._publishConsentData();}};EBG.Adaptors.CMPDetector.prototype={exists:false,initialized:false,subscriptions:[],_time:-1,_detectCMPLocator:function (){var f=window;var cmpFrame;while(!cmpFrame){try{if(f.frames["__cmpLocator"]){cmpFrame=f};}catch(e){}if(f===window.top){break};f=f.parent;}var cmpCallbacks={};if(cmpFrame){this.exists=true;window.__cmp=function (cmd,arg,callback){var callId=Math.random()+"";var msg={__cmpCall:{command:cmd,parameter:arg,callId:callId}};cmpCallbacks[callId]=callback;cmpFrame.postMessage(msg,'*');};window.addEventListener("message",function (event){try{var json=typeof event.data==="string"?JSON.parse(event.data):event.data;if(json.__cmpReturn){var i=json.__cmpReturn;cmpCallbacks[i.callId](i.returnValue,i.success);delete cmpCallbacks[i.callId];}}catch(e){}},false);}},_getConsentData:function (callback){var $this=this;try{(function (){var callee=arguments.callee;if($this.exists&&$this.initialized&&!$this.cmpCheckTimedout){__cmp('getConsentData',null,function (result,success){if(success){$this._setReason(1);callback.apply($this,[result]);}else{$this._setReason(2);callback.apply($this,[null]);}});}else{if(!$this.cmpCheckTimedout){setTimeout(function (){callee.apply($this,[]);},5)}}})();}catch(e){}},getConsentData:function (cb,context){if(typeof this.consentData!="undefined"){cb.apply(context,[this.consentData]);}else{this.subscriptions.push({callback:cb,context:context||this});}},_setDefaultValue:function (){this.initialized=true;this.consentData=this.defaultConsentData;},_publishConsentData:function (){if(typeof this.consentData=="undefined"){return;}for(var i=0;i<this.subscriptions.length;i++){var sub=this.subscriptions[i];try{sub.callback.apply(sub.context,[this.consentData]);}catch(e){}}this.subscriptions=[];},_setReason:function(code){if(typeof this._reason=="undefined"){this._reason=code;}},defaultConsentData:null};