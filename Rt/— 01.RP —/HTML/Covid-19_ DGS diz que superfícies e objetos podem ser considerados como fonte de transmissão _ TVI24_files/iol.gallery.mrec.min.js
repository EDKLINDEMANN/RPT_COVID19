!function(l,e,i,o){"use strict";var t={galId:0,coverId:0,loadingIconSrc:"https://cdn.iol.pt/js/utils/gallery/loading.svg",smartToken:"",platform:"WEB",pageUrl:"",pageTitle:"",loop:!0,pub:"",nav:!1,alwaysShowPub:!1,navHTML:["",""],autoplay:!1,autoplayTimeout:5e3,autoplayHoverPause:!1,startPosition:0,responsive:!1,onChanged:function(l){}};function a(e,i){this.iolGallery={},this.iolGallery.options=l.extend({},t,i),this.iolGallery.galleryElement=l(e),this.iolGallery.firstClick=!1,this.iolGallery.isSentToSlide=!1,this.iolGallery.quantity=5,this.iolGallery.loadedAtStart=0,this.iolGallery.loadedAtEnd=0,this.iolGallery.total=-1,this.iolGallery.missing=-1,this.iolGallery.lastIndex=0,this.iolGallery.loading=!1,this.iolGallery.loadMoreAfter=3,this.iolGallery.galleryTitle="",this.iolGallery.galleryDescription="",this.iolGallery.adSource="https://cdn.iol.pt/js/pb.html?adUnit="+this.iolGallery.options.pub+"/MPU_GAL&size=[300,250]",this.init()}function r(l){return l===o||""===l?"":l.toLowerCase().replace(new RegExp("\\p{InCombiningDiacriticalMarks}+","g"),"").replace(new RegExp("[^\\p{Alnum}]+","g"),"-").replace(new RegExp("[^A-Za-z0-9]+$","g"),"").replace(new RegExp("^[^A-Za-z0-9]+","g"),"")}a.prototype={init:function(){if(0===this.iolGallery.options.galId)return!1;Date.now||(Date.now=function(){return(new Date).getTime()}),this.iolGallery.galleryDivId="iolgallery_"+Date.now(),this.iolGallery.galleryElement.html('<div id="'+this.iolGallery.galleryDivId+'" tabindex="0" class="iolgallery"><div class="iolgallery-content"><div class="owl-carousel"></div></div></div>'),this.iolGallery.slideshowElement=l(".owl-carousel",this.iolGallery.galleryElement);var e=this;this.initSlides(function(){e.setupSlideshow(),e.setupEvents()})},initSlides:function(e){var i=this;l.getJSON("https://www.iol.pt/json_gallery_with_cover.html",{gal_id:i.iolGallery.options.galId,cover_id:i.iolGallery.options.coverId,quantity:500,loaded:0},function(t){if(i.iolGallery.galleryTitle=t.gallery.title,i.iolGallery.galleryDescription=t.gallery.description,i.iolGallery.slides=t.gallery.images,i.iolGallery.nextIndex=o,i.iolGallery.prevIndex=o,i.iolGallery.total=t.gallery.total,i.iolGallery.pubPositions=[],"sponsored"!=i.iolGallery.options.pub&&i.iolGallery.options.alwaysShowPub)for(var a=2;a<=i.iolGallery.total;)i.iolGallery.pubPositions.push({position:a,type:"pub"}),a+=5;var r,s,n,y=0;i.iolGallery.pubPositions.forEach(l=>{i.iolGallery.slides.splice(l.position+y,0,l),y++}),i.iolGallery.missing=i.iolGallery.slides.length,i.iolGallery.slides.length<=3*i.iolGallery.quantity?(r=i.iolGallery.slides.length,s=-1):(r=i.iolGallery.quantity,s=i.iolGallery.slides.length-i.iolGallery.quantity,i.iolGallery.nextIndex=r,i.iolGallery.prevIndex=s);for(var d=0;d<r;d++)n=l(i.createSlide(d,i.iolGallery.slides[d])),i.iolGallery.slideshowElement.append(n),i.iolGallery.loadedAtStart++,i.iolGallery.missing--;if(-1!=s)for(d=s;d<i.iolGallery.slides.length;d++)n=l(i.createSlide(d,i.iolGallery.slides[d])),i.iolGallery.slideshowElement.append(n),i.iolGallery.loadedAtEnd++,i.iolGallery.missing--;i.iolGallery.slideshowElement.trigger("refresh.owl.carousel"),e.call()})},createSlide:function(l,o){var t,a,s="";if("pub"!=o.type){var n=e.innerWidth>=1024?1300:2*e.innerWidth,y=r(o.title)===r(this.iolGallery.galleryTitle)||r(o.title)===r(this.iolGallery.galleryDescription)?"":o.title;s=`<div class="iolgallery-slide-wrapper" id="${l}">\n                                <div class="iolgallery-slide owl-lazy" data-src="${o.path}${n}"></div>\n                                <div class="iolgallery-slide-title">\n                                    <div class="iolgallery-slide-number" data-number="${o.number}"><span>${o.number}</span>/${this.iolGallery.total}</div> ${y}\n                                    ${o.description?`<div class="iolgallery-slide-description">${t=o.description,a=i.createElement("div"),a.innerHTML=t,0===a.childNodes.length?"":a.childNodes[0].nodeValue}</div>`:""}\n                                </div>\n                            </div>`}else s=`<div class="iolgallery-slide" id="pub${l}"><div class="iolgallery-slide-pub"><div class="iolgallery-slide-pub-content">PUB</div></div></div>`;return s},setupSlideshow:function(){this.iolGallery.slideshowElement.owlCarousel({items:1,lazyLoad:!0,pub:this.iolGallery.options.pub,loop:this.iolGallery.options.loop,nav:this.iolGallery.options.nav,navText:this.iolGallery.options.navHTML,autoplay:this.iolGallery.options.autoplay,autoplayTimeout:this.iolGallery.options.autoplayTimeout,autoplayHoverPause:this.iolGallery.options.autoplayHoverPause,startPosition:this.iolGallery.options.startPosition,responsive:this.iolGallery.options.responsive})},setupEvents:function(){var e=this;this.iolGallery.slideshowElement.on("changed.owl.carousel",function(i){if(i.property&&(!i.property||"position"==i.property.name))if(e.iolGallery.isSentToSlide)e.iolGallery.isSentToSlide=!1;else{if(e.sendAnalyticsEvents(),e.iolGallery.options.smartToken&&!e.iolGallery.firstClick){var o=`https://services.iol.pt/smartTopEncoded?token=${e.iolGallery.options.smartToken}`;l(`#${e.iolGallery.galleryDivId}`).append(`<img src='${o}' style="display:none;" height='1' width='1'/>`),e.iolGallery.firstClick=!0}e.iolGallery.options.onChanged.call(this,i);var t=i.page.index-e.iolGallery.lastIndex,a=t>0?t>1?"prev":"next":t<-1?"next":"prev";e.iolGallery.lastIndex=i.page.index,e.loadPub(i),e.iolGallery.loading||0==e.iolGallery.missing||("next"==a&&i.page.index<e.iolGallery.loadedAtStart&&i.page.index+e.iolGallery.loadMoreAfter>=e.iolGallery.loadedAtStart||"prev"==a&&i.page.index-(i.page.count-e.iolGallery.loadedAtEnd)>0&&i.page.index-e.iolGallery.loadMoreAfter<=i.page.count-e.iolGallery.loadedAtEnd)&&(e.iolGallery.loading=!0,e.loadMoreSlides(i.page.index,a,function(){e.iolGallery.loading=!1}))}}),this.iolGallery.galleryElement.on("keyup",function(e){37===e.keyCode?l(".owl-prev").click():39===e.keyCode&&l(".owl-next").click()})},sendAnalyticsEvents:function(){var l=""!=this.iolGallery.options.pageUrl?this.iolGallery.options.pageUrl:location.pathname,e=""!=this.iolGallery.options.pageTitle?this.iolGallery.options.pageTitle:i.title;try{IOLAnalytics.updateVirtualPageView("slide",!1,location.pathname,i.title,{Titulo:this.iolGallery.galleryTitle})}catch(i){dataLayer&&dataLayer.push({virtualPageURL:l,virtualPageTitle:e,event:"VirtualPageview",Tipo_Conteudo:"Galeria",Titulo:this.iolGallery.galleryTitle,Plataforma:this.iolGallery.options.platform})}},loadPub:function(e){var i=l(l(`#${this.iolGallery.galleryDivId} .owl-item`)[e.item.index]);if(i.find(".iolgallery-slide-pub").length>=1){var o;l(`#${this.iolGallery.galleryDivId} .owl-carousel *`).bind("touchmove",!1),l(`#${this.iolGallery.galleryDivId} .owl-next`).css("pointer-events","none"),l(`#${this.iolGallery.galleryDivId} .owl-prev`).css("pointer-events","none"),o=`<div class="a"></div>\n                    <iframe width="300" height="250" frameborder="0" allowtransparency scrolling="no" allowfullscreen src="${this.iolGallery.adSource}"></iframe>\n                    <br/>PUB\n                    <img src="${this.iolGallery.options.loadingIconSrc}" width="34" style="width:20px; display:block; margin:25px auto 0 auto;transition:all 0.2s;"/>\n                    <div class="b"></div>`,i.find(".iolgallery-slide-pub-content").html(o);var t=this;setTimeout(function(){l(`#${t.iolGallery.galleryDivId} .owl-carousel *`).unbind("touchmove"),l(`#${t.iolGallery.galleryDivId} .owl-next`).css("pointer-events","auto"),l(`#${t.iolGallery.galleryDivId} .owl-prev`).css("pointer-events","auto"),i.find("img").css("opacity","0")},1500)}else l(".iolgallery-slide-pub-content").html("")},loadMoreSlides:function(e,i,o){if(!(this.iolGallery.missing<=0)){var t,a,r,s;"next"==i?(t=this.iolGallery.nextIndex,a=(a=this.iolGallery.nextIndex+this.iolGallery.quantity)>this.iolGallery.prevIndex?this.iolGallery.nextIndex+this.iolGallery.missing:a,r=this.iolGallery.nextIndex,this.iolGallery.nextIndex=a):(t=(t=this.iolGallery.prevIndex-this.iolGallery.quantity)<this.iolGallery.nextIndex?this.iolGallery.prevIndex-this.iolGallery.missing:t,a=this.iolGallery.prevIndex,r=this.iolGallery.nextIndex,this.iolGallery.prevIndex=t,this.iolGallery.isSentToSlide=!0);for(var n=t;n<a;n++)s=l(this.createSlide(n,this.iolGallery.slides[n])),this.iolGallery.slideshowElement.trigger("add.owl.carousel",[s,r++]),"next"==i?this.iolGallery.loadedAtStart++:this.iolGallery.loadedAtEnd++,this.iolGallery.missing--;this.iolGallery.slideshowElement.trigger("refresh.owl.carousel"),"prev"==i&&this.iolGallery.slideshowElement.trigger("to.owl.carousel",[e+this.iolGallery.quantity,-1]),o.call()}}},l.fn.iolgallery=function(e){if(e===o||"object"==typeof e)return this.each(function(){l(this).data("iolgallery",new a(this,e))});if("string"==typeof e&&"_"!==e[0]&&"init"!==e){var i,t=arguments;return this.each(function(){var o=l.data(this,"iolgallery");o instanceof a&&"function"==typeof o[e]&&(i=o[e].apply(o,Array.prototype.slice.call(t,1)))}),i!==o?i:this}}}(jQuery,window,document);